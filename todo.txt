if (event.getWorld() == Bukkit.getWorld("world") && random.nextDouble() < 0.5)
		{
			
			for (String spell : ChestGenSpellRegistry.chestgen_registry.keySet()) 
			{
				if(random.nextDouble() < 0.5)
				{
					
					ItemStack s = ChestGenSpellRegistry.chestgen_registry.get(spell).generate();
					
					event.getLoot().add(random.nextInt(), s);
					
					if (event.getLoot().size() == 28) 
					{
						event.getLoot().add(27,s);
					}
					else
					{
						event.getLoot().add(s);
					}
					
					break;
				}
			}
		}

public class CastingListener implements Listener
{
	@EventHandler
	public void onCast(PlayerInteractEvent event) 
	{
		ItemStack held;
		held = event.getPlayer().getInventory().getItem(EquipmentSlot.HAND) ;
	
		if (event.getHand() == null) 
		{
			return;
		}
		
		if (event.getHand().equals(EquipmentSlot.OFF_HAND))
		{
			return;
		}
		
		//if in offhand, return.
		if(held==null || held.getType().equals(Material.AIR))
		{
			return ;
		}
		//if a spell is being used in the air that otherwise would not be cast in, return.
		if(ItemUtils.hasNamespacedKey(held, "spellname")) 
		{
			event.setUseInteractedBlock(Event.Result.DENY);
			event.setUseItemInHand(Event.Result.DENY);
			
			//PrintUtils.log(event.getAction().toString());

			String spell = ItemUtils.readFromNamespacedKey(held, "spellname");
		
			if (PlayerDataMana.getPlayerData(event.getPlayer()).getCurrentMana()>=CastListener.spell_registry.get(spell).getManaCost()) 
			{
				if(CastListener.spell_registry.get(spell).cast(event)) 
				{
					PlayerDataMana.getPlayerData(event.getPlayer()).setCurrentMana(PlayerDataMana.getPlayerData(event.getPlayer()).getCurrentMana() - CastListener.spell_registry.get(spell).getManaCost());
					ManaInterface.updateScoreBoard(event.getPlayer());
					return;		
				}
				return;
			}
			//mana cost
			PrintUtils.sendMessage(event.getPlayer(), "Mana Insufficient.");
		
			return;
		}
	}
}



Git Access Token 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

Make a mechanic to overdraw mana. 
When the player's mana is in the negative, apply fatigue, weakness, and slowness.
When the player's mana is put into the negative, give them a message saying "Mana reserves depleted. You begin to feel sick."
While the player's mana is negative, the player may not cast any spells, and give them a message saying "FIZZLE! You currently have Mana Sickness."
When the player's mana regenerates into the positive, remove Mana sickness effects.




















